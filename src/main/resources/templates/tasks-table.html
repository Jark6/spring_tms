<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="EN">
<head>
    <title>Список задач</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.2/dist/bootstrap-table.min.css">
</head>
<body>
<header th:insert="~{blocks/header :: header}"></header>

<div class="container mt-5">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <h1>Таблица задач</h1>
            </div>
            <div class="col-md-4 d-flex justify-content-end">
                <div class="d-flex flex-column justify-content-end align-items-center">
                <label for="taskPanel" class="form-label mb-0"><small>Режим отображения задач</small></label><br>
                <div id="taskPanel" class="btn-group-sm ml-2" role="group" aria-label="taskPanel">
                    <a class="btn btn-secondary" href="/tasks">Список</a>
                    <a class="btn btn-secondary" href="/tasks/table">Таблица</a>
                </div></br>
                </div>
            </div>
        </div>
    </div>



    <div class="table table-hover table-striped table-responsive-sm table-sm">
    <table data-toggle="table" class="table" id="tasks-table"
           data-pagination="true"
           data-search="true"
           data-advanced-search="true"
           data-id-table="advancedTable"
           data-action-form="pop-up"
           data-id-form="advancedSearch">
        <thead>
        <tr>
            <th scope="col" data-field="id" data-advanced-search="true" data-sortable="true" data-sorter="numeric">№</th>
            <th scope="col" data-field="name" data-sortable="true">Название</th>
   <!--         <th scope="col" data-field="descriptiom" data-sortable="true">Описание</th>-->
            <th scope="col" data-field="taskType" data-sortable="true">Тип задачи</th>
            <th scope="col" data-field="deadline" data-sortable="true">Срок исполнения</th>
            <th scope="col" data-field="deadline" data-sortable="true">Приоритет</th>
            <th scope="col" data-field="status" data-sortable="true">Статус</th>
            <th scope="col" data-field="project" data-sortable="true">Проект</th>
            <th scope="col" data-field="linkedTask" data-sortable="true">Связанная задача</th>
            <th scope="col" data-field="linkedTaskType" data-sortable="true">Тип связи</th>
            <th scope="col" data-field="author" data-sortable="true">Автор</th>
            <th scope="col" data-field="executor" data-sortable="true">Исполнитель</th>
            <th scope="col" data-field="dateCreate" data-sortable="true">Создана</th>
            <th scope="col" data-field="dateEdit" data-sortable="true">Изменена</th>
        </tr>
        </thead>
        <tbody>
        <!-- Loop through tasks and display them in the table -->
        <tr  th:each="task : ${tasks}" scope="row" > <!--th:sort="${task.task_id}-->
            <td class="table-row" style="white-space: nowrap"> <!--th:text="'T-'+${task.task_id}"-->
                <a th:href="'/tasks/' + ${task.task_id}"><span th:utext="${'T-' + task.task_id}"></span></a>
            </td>
            <td class="table-row" th:utext="${task.short_description}"></td>
           <!-- <td class="table-row" th:utext="${task.full_description}"></td>-->
            <td class="table-row" th:text="${task.task_type_id != null} ? ${task.task_type_id.task_type} : ''"></td>
            <td class="table-row" th:text="${#dates.format(task.deadline, 'dd-MM-yyyy')}"></td>
            <td class="table-row" th:text="${task.priority_id != null} ? ${task.priority_id.priority} : ''"></td>
            <td class="table-row" th:text="${task.status_id != null} ? ${task.status_id.status} : ''"></td>
            <td class="table-row" th:text="${task.project_id != null} ? ${task.project_id.project_name} : ''"></td>
            <td class="table-row" th:text="${task.linked_task_id != null} ? 'T-'+${task.linked_task_id} : ''"></td>
            <td class="table-row" th:text="${task.linked_task_type_id != null} ? ${task.linked_task_type_id.linked_task_type} : ''"></td>
            <td class="table-row" th:text="${task.author_id != null} ? ${task.author_id.second_name} : ''"></td>
            <td class="table-row" th:text="${task.executor_id != null} ? ${task.executor_id.second_name} : ''"></td>
            <td class="table-row" th:text="${#temporals.format(task.timestamp_create, 'dd-MM-yyyy')}" style="white-space: nowrap" ></td>
            <td class="table-row" th:text="${#temporals.format(task.timestamp_edit, 'dd-MM-yyyy')}" style="white-space: nowrap" ></td>
        </tr>
        </tbody>
    </table>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://unpkg.com/bootstrap-table@1.22.2/dist/bootstrap-table.min.js"></script>
<!-- Latest compiled and minified Locales-->
<script src="https://unpkg.com/bootstrap-table@1.22.2/dist/locale/bootstrap-table-ru-RU.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-table@1.22.2/dist/extensions/toolbar/bootstrap-table-toolbar.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.22.2/dist/locale/bootstrap-table-ru-RU.min.js"></script>
<script>
    $('#tasks-table').bootstrapTable({
        pagination: true,
        search: true,
        sortable: true,
        sortName: 'id',
        columns: [{
            field: 'id',
            title: '№',
            sortable: true,
            sorter: 'numeric'
        }, {
            field: 'name',
            title: 'Название',
            sortable: true
        }, /*{
            field: 'description',
            title: 'Описание',
            sortable: true
        },*/ {
            field: 'taskType',
            title: 'Тип задачи',
            sortable: true
        }, {
            field: 'deadline',
            title: 'Срок исполнения',
            sortable: true
        }, {
            field: 'priority',
            title: 'Приоритет',
            sortable: true
        }, {
            field: 'status',
            title: 'Статус',
            sortable: true
        }, {
            field: 'project',
            title: 'Проект',
            sortable: true
        }, {
            field: 'linkedTask',
            title: 'Связанная задача',
            sortable: true
        }, {
            field: 'linkedTaskType',
            title: 'Тип связи',
            sortable: true
        }, {
            field: 'author',
            title: 'Автор',
            sortable: true
        }, {
            field: 'executor',
            title: 'Исполнитель',
            sortable: true
        }, {
            field: 'dateCreate',
            title: 'Создана',
            sortable: true
        }, {
            field: 'dateEdit',
            title: 'Изменена',
            sortable: true
        }],
    })
</script>
<script>
    $(document).ready(function () {
        // Обработка события клика на строке таблицы
        $('.table-row').on('click', function () {
            console.log('click');
            // Получаем ссылку из первой ячейки строки
            let link = $(this).find('tr:first-child a').attr('href');
            // Перенаправляем пользователя по ссылке
            if (link) {
                window.location.href = link;
            }
        });
    });
</script>
<div th:insert="~{blocks/footer :: footer}"></div>
</body>
</html>