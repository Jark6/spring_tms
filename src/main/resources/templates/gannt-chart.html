<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="EN">
<head>
    <title>Gantt chart</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

</head>
<body>
<header th:insert="~{blocks/header :: header}"></header>
<div th:insert="~{blocks/reports-menu::reports-menu}"></div>
<div th:insert="~{blocks/reports-dates::reports-dates}"></div>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {
            'packages': ['gantt'],
            'language': 'ru'
        });

        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            fetch('/api')
                .then(response => response.json())
                .then(jsonData => {
                    var ganttData = [
                        ['Task ID', 'Task Name', 'Start Date', 'End Date', 'Duration', 'Percent Complete', 'Dependencies']
                    ];
                    console.log(jsonData);
                    jsonData.forEach(task => {
                            ganttData.push([
                            task.task_id.toString(),
                            task.short_description,
                            new Date(task.timestamp_create),
                            new Date(task.deadline),
                                null, 0, null
                        ]);
                    });
                    console.log(ganttData);

                    // Создание и отображение диаграммы Ганта
                    var data = new google.visualization.DataTable();
                    data.addColumn('string', 'Идентификатор задач');
                    data.addColumn('string', 'Название задачи');
                    data.addColumn('date', 'Начало выполнения задачи');
                    data.addColumn('date', 'Окончание выполнения задачи');
                    data.addColumn('number', 'Длительность'); // Длительность задачи в миллисекундах
                    data.addColumn('number', 'Процент выполнения задачи'); // Процент завершения задачи
                    data.addColumn('string', 'Зависимости'); // Зависимости задачи
                    data.addRows(ganttData.slice(1));

            var options = {
                height: 400,
                gantt: {
                    trackHeight: 30
                }
            };

            var chart = new google.visualization.Gantt(document.getElementById('chart_div'));

            chart.draw(data, options);
        })
                .catch(error => console.error('Error fetching data:', error));
        }
    </script>
<div class="container-fluid">
    <div class="row">
        <div class="col">
            <div id="chart_div"></div>
        </div>
    </div>
</div>


<div th:insert="~{blocks/footer :: footer}"></div>
</body>
</html>
